FROM python:3.11-slim AS builder

WORKDIR /petl

COPY ./requirements.txt /petl/requirements.txt

RUN apt -y update
RUN apt -y upgrade
RUN pip install --upgrade pip
RUN pip install --no-cache-dir -r requirements.txt

COPY . /petl

EXPOSE 8000

ENV RUNNING_DOCKER=true
CMD ["python3", "-m", "fastapi", "run", "--workers", "8", "src/server/server.py"]